(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&e(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function e(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();class d{#e;#s;#t;#n;#i;constructor(t,n,e,s="close"){this.#e=n,this.#s=t,this.#n=e,this.#t=s}get col(){return this.#e}get row(){return this.#s}get state(){return this.#t}get content(){return this.#n}get element(){return this.#i}set element(t){this.#i=t}set state(t){this.#t=t}set content(t){this.#n=t}}function h(r){let t=r.length;for(;t!=0;){let n=Math.floor(Math.random()*t);t--,[r[t],r[n]]=[r[n],r[t]]}}class m{#e;#s;#t;#n;cells;constructor(t,n,e,s,i){this.#e=t,this.#s=n,this.#t=e,this.#n=s,this.timer=i,this.cells=[]}get cols(){return this.#e}get rows(){return this.#s}get bomb(){return this.#t}get element(){return this.#n}buildArray(){const t=Array(this.#t).fill("B").concat(Array(this.#e*this.#s-this.#t).fill(0));h(t);const n=[];for(let s=0;s<this.#s;s++)n.push(t.slice(s*this.#e,(s+1)*this.#e));const e=this.asignArray(n);this.cells=[];for(let s=0;s<this.#s;s++){const i=[];for(let l=0;l<this.#e;l++){const o=new d(s,l,e[s][l]);i.push(o)}this.cells.push(i)}return this.cells}asignArray(t){const n=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)t[e][s]==="B"&&n.forEach(([i,l])=>{const o=e+i,c=s+l;o>=0&&o<t.length&&c>=0&&c<t[e].length&&t[o][c]!=="B"&&(t[o][c]+=1)});return t}Opencells(){this.#n.addEventListener("click",t=>{this.timer.start();const n=t.target.closest(".cell");if(!n)return;const e=this.cells.flat().find(s=>s.element===n);!e||e.state!=="close"||(e.content==="B"?(e.element.textContent="ðŸ’£",e.state="bomb",this.checkStateGame()):e.content>0?(e.element.textContent=e.content,e.state="open",this.cssColorCells(e),this.checkStateGame()):(this.revealAdjacent(e.row,e.col),this.checkStateGame()))})}revealAdjacent(t,n){if(t<0||t>=this.cells.length||n<0||n>=this.cells[0].length)return;const e=this.cells[t][n];if(!e||e.state==="open"||e.state==="flag"||e.content==="B")return;if(e.content>0){e.element.textContent=e.content,e.state="open",this.cssColorCells(e);return}e.state="open",e.element.textContent=e.content;const s=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];for(const[i,l]of s)this.revealAdjacent(t+i,n+l)}checkStateGame(){if(this.cells.flat().filter(e=>e.state==="open").length===this.#e*this.#s-this.#t){this.timer.stop(),this.storeBestTime();const e=document.createElement("div");e.classList.add("result"),e.innerHTML='<div class="popup"><h2>PARTIDA GANADA</h2></div>',document.body.appendChild(e)}if(this.cells.flat().find(e=>e.state==="bomb")){this.cells.flat().forEach(s=>{s.content==="B"&&(s.element.textContent="ðŸ’£")}),this.timer.stop();const e=document.createElement("div");e.classList.add("result"),e.innerHTML='<div class="popup"><h2>PARTIDA PERDIDA</h2></div>',document.body.appendChild(e)}}addFlagEvent(){const t=document.getElementById("flags");t.textContent=this.#t,this.#n.addEventListener("contextmenu",n=>{n.preventDefault();const e=n.target.closest(".cell");if(!e)return;const s=this.cells.flat().find(i=>i.element===e);!s||s.state==="open"||(s.state==="close"?(s.state="flag",s.element.textContent="ðŸš©"):s.state==="flag"&&(s.state="close",s.element.textContent=""),t.textContent=`${this.#t-this.cells.flat().filter(i=>i.state==="flag").length}`)})}restart(t){const n=document.querySelector(".result");n&&n.remove(),t.forEach(i=>i.textContent=""),this.buildArray().flat().forEach((i,l)=>{i.element=t[l],i.state="close"});const s=document.getElementById("flags");s.textContent=this.#t,this.timer.restart()}cssColorCells(t){const n=["white","blue","green","red","purple","maroon","turquoise","black","gray"];t.element.style.color=n[t.content]||"black"}storeBestTime(){let t="";this.#t===10?t="easy":this.#t===40?t="medium":this.#t===99?t="hard":t="custom";const n=this.timer.min*60+this.timer.sec+this.timer.ms/100,e=JSON.parse(localStorage.getItem(t));(!e||n<e)&&localStorage.setItem(t,JSON.stringify(n))}}class u{constructor(t){this.board=t}createCellsDom(){this.board.buildArray().forEach(s=>{s.forEach(i=>{const l=document.createElement("div");l.classList.add("cell"),i.element=l,this.board.element.appendChild(l)})});const n=document.getElementById("reset"),e=document.querySelectorAll(".cell");n.addEventListener("click",()=>this.board.restart(e)),this.board.Opencells(),this.board.addFlagEvent()}}class f{constructor(t,n){this.container=t,this.timer=n}async init(){const{row:t,col:n,bomb:e}=await this.getRowsColsBombs();this.setupBoard(t,n,e),this.handleDifficultyChange(),this.stadistics()}getRowsColsBombs(){return new Promise(t=>{const n=document.querySelector(".overlay");document.querySelectorAll(".level__btn").forEach(s=>{s.addEventListener("click",i=>{const l=i.currentTarget.dataset.level;let o,c,a;l==="easy"?(o=9,c=9,a=10):l==="medium"?(o=16,c=16,a=40):l==="hard"&&(o=16,c=30,a=99),setTimeout(()=>{n.style.display="none"},400),this.container.innerHTML="",t({row:o,col:c,bomb:a})})})})}setupBoard(t,n,e){this.gridRowsCols(t,n);const s=new m(n,t,e,this.container,this.timer);new u(s).createCellsDom()}gridRowsCols(t,n){this.container.style.gridTemplateColumns=`repeat(${n}, 30px)`,this.container.style.gridTemplateRows=`repeat(${t}, 30px)`}handleDifficultyChange(){document.getElementById("difficulty").addEventListener("click",async()=>{const n=document.querySelector(".result");n&&n.remove(),document.querySelectorAll(".cell").forEach(c=>c.remove());const s=document.querySelector(".overlay");s.style.display="flex";const{row:i,col:l,bomb:o}=await this.getRowsColsBombs();this.setupBoard(i,l,o)})}stadistics(){const t=document.getElementById("statsModal"),n=document.getElementById("statsList");document.getElementById("statsBtn").addEventListener("click",()=>{const e=document.querySelector(".result");e&&e.remove();const s=JSON.parse(localStorage.getItem("easy")),i=JSON.parse(localStorage.getItem("medium")),l=JSON.parse(localStorage.getItem("hard"));n.innerHTML=`
        <li><strong>FÃ¡cil:</strong> ${s?s.toFixed(2)+"s":"â€”"}</li>
        <li><strong>Medio:</strong> ${i?i.toFixed(2)+"s":"â€”"}</li>
        <li><strong>DifÃ­cil:</strong> ${l?l.toFixed(2)+"s":"â€”"}</li>
      `,t.style.display="block"}),document.getElementById("closeModal").addEventListener("click",()=>{t.style.display="none"}),window.addEventListener("click",e=>{e.target===t&&(t.style.display="none")})}}class g{constructor(t="timer"){this.idElement=t,this.ms=0,this.sec=0,this.min=0,this.count=null}start(){this.count||(this.count=setInterval(()=>{this.ms===100?(this.ms=0,this.sec===60?(this.sec=0,this.min++):this.sec++):this.ms++;const t=this.pad(this.min),n=this.pad(this.sec),e=this.pad(this.ms);this.update(`${t}:${n}:${e}`)},10))}stop(){clearInterval(this.count),this.count=null}update(t){const n=document.getElementById(this.idElement);n&&n.firstChild&&(n.firstChild.nodeValue=t)}restart(){this.stop(),this.ms=0,this.sec=0,this.min=0,this.update("00:00:00")}pad(t){return t<10?"0"+t:t}}const p=document.getElementById("game"),y=new g("timer"),b=new f(p,y);b.init();
